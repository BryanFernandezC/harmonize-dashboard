---
title: "Innovalab-UPCH"
output: 
  flexdashboard::flex_dashboard:
    logo: https://user-images.githubusercontent.com/39299104/207467842-d92416da-c312-4a9c-9cbf-a23a93da6465.png
    favicon: https://raw.githubusercontent.com/healthinnovation/innovar/gh-pages/favicon.ico
    orientation: columns
    vertical_layout: fill
    navbar:
        - { icon: "fa-github", href: "https://github.com/healthinnovation", align: right}
    self_contained: false
    lib_dir: "lib"
---


<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto+Slab&display=swap');
body{
    font-family: 'Roboto Slab', serif;
}

.navbar{
    padding-left: 28px;
}

.navbar-logo {
    margin-top: 2px;
    width: 36.5px;
    position: fixed;
    left: 2px;
    margin-bottom: 2px;
}

.navbar-inverse {
    background-color: #070807;
    border-color: #070807;
}
.navbar-inverse .navbar-brand {
    color: #ffffff;
}
.navbar-inverse .navbar-nav>.active>a, .navbar-inverse .navbar-nav>.active>a:hover, .navbar-inverse .navbar-nav>.active>a:focus {
    color: #ffffff;
    background-color: #ffffff2e;
}
.navbar-inverse .navbar-nav>li>a {
    color: #ffffff;
}
.navbar-inverse .navbar-brand:hover, .navbar-inverse .navbar-brand:focus {
    color: #ffffff;
    background-color: #ffffff00;
}
</style>


```{r setup, include=FALSE}
library(flexdashboard)
library(dplyr)
library(ggplot2)
library(tidyr)
library(plotly)
```

```{r}
metadata <- readr::read_csv(
  "data/metadata.csv", col_types = readr::cols(.default = "c"),
  locale = readr::locale(encoding = "Latin1")
)
```

Main {data-icon="fa fa-bar-chart"}
=====================================================================


Column {data-width=650}
-----------------------------------------------------------------------

### Reviewed datasets by dimension

```{r}
reviewed_datasets <- metadata %>% 
  group_by(dimension) %>% 
  summarise(datasets = n(), .groups = "drop")
```

```{r}
reviewed_datasets_plot <- reviewed_datasets %>% 
  ggplot(aes(dimension, datasets)) + 
  geom_bar(stat = "identity", color = "#374be6", fill = "#374be6") + 
  scale_y_continuous(breaks = seq(0, max(reviewed_datasets$datasets), 5)) +
  coord_flip() +
  theme_minimal() + 
  labs(y = "Total reviewed datasets", x = "Dimension")
```

```{r}
reviewed_datasets_plot %>% 
  ggplotly() %>% 
  config(displayModeBar = F)
```

### Reviewed datasets by dimension along weeks

```{r}
reviewed_datasets_week <- metadata %>% 
  group_by(dimension, week) %>% 
  summarise(datasets = n()) %>% 
  complete(week = unique(metadata$week)) %>% 
  replace_na(list(datasets = 0)) %>% 
  ungroup()
```

```{r}
reviewed_datasets_week_total <- reviewed_datasets_week %>% 
  pivot_wider(id_cols = week, names_from = dimension, values_from = datasets) %>% 
  mutate(Total = Health + Demographics + Climate) %>% 
  pivot_longer(-week, names_to = "dimension", values_to = "datasets")
```

```{r}
reviewed_datasets_week_plot <- reviewed_datasets_week_total %>% 
  ggplot(aes(week, datasets, group = dimension, color = dimension)) +
  geom_point() +
  geom_line() +
  ggsci::scale_color_npg() +
  theme_minimal() +
  labs(x = "Week", y = "Reviewed datasets", color = "Dimension")
```

```{r}
reviewed_datasets_week_plot %>%
  ggplotly() %>%
  config(displayModeBar = F)
```


Health {data-icon="fa fa-database"}
===============================================================

```{r}
metadata %>% 
  filter(dimension == "Health") %>% 
  reactable::reactable(highlight = TRUE)
```

Demographics {data-icon="fa fa-database"}
===============================================================

```{r}
metadata %>% 
  filter(dimension == "Demographics") %>% 
  reactable::reactable(highlight = TRUE)
```


Climate {data-icon="fa fa-database"}
===============================================================

```{r}
metadata %>% 
  filter(dimension == "Climate") %>% 
  reactable::reactable(highlight = TRUE)
```
